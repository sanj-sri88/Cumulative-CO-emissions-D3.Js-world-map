var isitRunning=!1;var nestD;var var_schaal=[3,2,1,0,-66,-77,-999,-1111],cumm_schaal=[10,9,8,7,6,5,4,3,2,1,0,-66,-77,-1111],cumm_labels=["10","9","8","7","6","5","4","3","2","1","0"];var var_kleur=d3.scale.ordinal().domain([0,1,2,3,-66,-77,-999,-1111]).range(["red","orange","yellow","green","midnightblue","black","silver","lightgrey"]);var som_kleur=d3.scale.ordinal().domain([0,1,2,3,4,5,6,7,8,9,10,-66,-77,-1111]).range(["darkred","crimson","red","orangered","orange","gold","yellow","greenyellow","lime","limegreen","green","midnightblue","black","lightgrey"]);var currentYear=2017;d3.select("#jaarkop").html("Cumulative CO₂ emissions,"+currentYear);d3.select("#tijdSlide").property("value",currentYear);var v="SUM";d3.select("#meterplaatje").attr("src","gauge_active.gif");var xy=d3.geo.equirectangular().scale(736).translate([377,200]);path=d3.geo.path().projection(xy);var svg=d3.select("#chart").append("svg").attr("width",750).attr("height",350).append("g").call(d3.behavior.zoom().on("zoom",redraw))
var countries=svg.append("g").attr("id","countries");debugger;d3.json("http://localhost:8080/test_2/javascript/world-countries.json",function(json){countries.selectAll("path").data(json.features).enter().append("path").attr("d",path).on("mouseover",lightenUp).on("mouseout",lightenDown)});d3.json("http://localhost:8080/test_2/javascript/ciricountries.json",function(json){thisdata=json.filter(function(d){return d.YEAR==currentYear});nestD=d3.nest().key(function(d){return d.CTRY}).rollup(function(a){return a[0][v]}).map(thisdata);countries.selectAll("path").attr("d",path).style("fill",function(d){return v=="SUM"?som_kleur(d3.round(nestD[d.properties.name])):var_kleur(nestD[d.properties.name])}).append("title").text(function(d){return d.properties.name+", score: "+nestD[d.properties.name]})});function wissel_jaar(form,v){console.log(form);console.log(form.name);if(isitRunning){return}
console.log(currentYear);d3.select("#jaarkop").html("Cumulative CO₂ emissions,"+currentYear);d3.json("http://localhost:8080/test_2/javascript/ciricountries.json",function(json){thisdata=json.filter(function(d){return d.YEAR==currentYear});nestD=d3.nest().key(function(d){return d.CTRY}).rollup(function(a){return a[0][v]}).map(thisdata);countries.selectAll("path").transition().duration(1500).style("fill",function(d){return v=="SUM"?som_kleur(d3.round(nestD[d.properties.name])):var_kleur(nestD[d.properties.name])})
countries.selectAll("title").text(function(d){return d.properties.name+", score: "+nestD[d.properties.name]})});if(v=="SUM"){sumscaleMe()}else{varscaleMe()}}
function animeerMij(u,w,v){if(isitRunning)return;else isitRunning=!0;d3.select(u).attr("src",w);var currentYear=1949;targetYear=2017;function step(){d3.select("#jaarkop").html("Cumulative CO₂ emissions,"+currentYear);d3.select("#tijdSlide").property("value",currentYear);d3.json("http://localhost:8080/test_2/javascript/ciricountries.json",function(json){thisdata=json.filter(function(d){return d.YEAR==currentYear-1});nestD=d3.nest().key(function(d){return d.CTRY}).rollup(function(a){return a[0][v]}).map(thisdata);countries.selectAll("path").transition().duration(1500).style("fill",function(d){return v=="SUM"?som_kleur(d3.round(nestD[d.properties.name])):var_kleur(nestD[d.properties.name])});countries.selectAll("title").text(function(d){return d.properties.name+", score: "+nestD[d.properties.name]})});currentYear++;if(currentYear<=targetYear)
setTimeout(step,1500+250);else isitRunning=!1;return}
step()}
function redraw(){svg.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}
function lightenUp(d,i){d3.select(this).transition().duration(100).ease("bounce").style("stroke-width","2px").style("stroke","grey")};function lightenDown(d,i){d3.select(this).transition().duration(100).style("stroke-width",".3px").style("stroke","black")};function sumscaleMe(){schaaltje=cumm_schaal;uitleg.selectAll("g.bar").remove();var schaler=uitleg.selectAll("g.bar").data(schaaltje).enter().append("g").attr("class","bar").attr("transform",function(d,i){return"translate(2, "+i*18+")"});schaler.append("rect").attr("class","rect").attr("y",0).attr("width",16).attr("height",16).style("fill",function(d){return som_kleur(d)}).attr("stroke","dimgrey").attr("rx",3).attr("ry",3).append("title").text(function(d){return d});schaler.append("text").text(function(d){return d}).attr("x",53).attr("y",10).attr("text-anchor","end")}
function varscaleMe(){schaaltje=var_schaal;uitleg.selectAll("g.bar").remove();var schaler=uitleg.selectAll("g.bar").data(schaaltje).enter().append("g").attr("class","bar").attr("transform",function(d,i){return"translate(2, "+i*18+")"});schaler.append("rect").style("fill",function(d){return var_kleur(d)}).attr("class","rect").attr("y",0).attr("width",16).attr("height",16).attr("rx",3).attr("ry",3).attr("stroke","dimgrey").append("title").text(function(d){return d});schaler.append("text").text(function(d){return d}).attr("x",53).attr("y",10).attr("text-anchor","end")}